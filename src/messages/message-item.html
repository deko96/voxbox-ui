<link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-item/paper-item-body.html">
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="message-item-behavior.html">
<link rel="import" href="message-item-styles.html">

<dom-module id="message-item">
    <template>
        <style include="message-item-styles"></style>
        <style>
            :host {
                padding: 0;
            }
            .message-item {
                background: white;
            }
            .list-item {
                margin: 0 auto;
                max-width: 650px;
                min-height: 70px;
                border-bottom: 1px solid #dadada;
            }
            .grid-item {
                width: 290px;
                height: 200px;
                display: flex;
                justify-content: space-between;
                flex-direction: column;
                margin: 2px;
            }
            .grid-item .content {
                height: 80px;
                padding-top: 0;
                word-wrap: break-word;
            }
            .controls {
                align-self: flex-end;
                padding: 5px;
            }
        </style>
        <div class$="[[_getClass(grid)]]">
            <paper-item role="menuitemcheckbox">
                <paper-checkbox
                    on-tap    = "_toggleSelected"
                    checked   = "[[selected]]">
                </paper-checkbox>
                <paper-item-body>
                    <div secondary class="date">
                        <span>[[_formatDate(item.timestamp)]]</span>
                    </div>
                    <div>[[item.endpoint]]</div>
                </paper-item-body>
                <template is="dom-if" if="{{!grid}}">
                    <paper-icon-button 
                        class   = "star"
                        hidden$ = "[[outgoing]]"
                        on-tap  = "_toggleFavorite"
                        icon    = "[[_favoriteButtonIcon(item.favorite)]]">
                    </paper-icon-button>
                    <paper-icon-button 
                        on-tap  = "_showMessage"
                        icon    = "unfold-more">
                    </paper-icon-button>
                </template>
            </paper-item>
            <div class="content">
                [[_truncated(item.content)]]
            </div>
            <template is="dom-if" if="{{grid}}">
                <div class="controls">
                    <paper-icon-button 
                        class  = "star"
                        on-tap = "_toggleFavorite"
                        icon   = "[[_favoriteButtonIcon(item.favorite)]]">
                    </paper-icon-button>
                    <paper-icon-button 
                        on-tap = "_showMessage"
                        icon   = "unfold-more">
                    </paper-icon-button>
                </div>
            </template>
        </div>
    </template>
    <script>
    var MAX_MESSAGE_LENGTH = 130;

    Polymer({

        is: 'message-item',

        behaviors: [
            MessageItemBehavior,
        ],

        _truncated: function(content) {
            if (!this.grid) return content;
            return (content.length > MAX_MESSAGE_LENGTH) 
            ? content.substring(0, MAX_MESSAGE_LENGTH) + 'â€¦' : content;
        },

        _getClass: function(grid) {
            return grid ? 'grid-item' : 'list-item';
        }

    });

    </script>
</dom-module>